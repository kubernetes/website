{{ $cover := and
    (.HasShortcode "blocks/cover")
    (not .Site.Params.ui.navbar_translucent_over_cover_disable)
-}}

<nav class="js-navbar-scroll navbar navbar-expand-md navbar-dark
            {{- if $cover }} td-navbar-cover {{- end }} flex-md-column flex-xl-row td-navbar">
  <a class="navbar-brand" href="{{ .Site.Home.RelPermalink }}">
    {{- /**/ -}}
    <span class="navbar-brand__logo navbar-logo">
      {{- if ne .Site.Params.ui.navbar_logo false -}}
        {{ with resources.Get "icons/logo.svg" -}}
          {{ ( . | minify).Content | safeHTML -}}
        {{ end -}}
      {{ end -}}
    </span>
    {{- /**/ -}}
    <span class="navbar-brand__name">
      {{- .Site.Title -}}
    </span>
    {{- /**/ -}}
  </a>
  <button
    class="navbar-toggler ml-auto"
    type="button"
    data-toggle="collapse"
    data-target="#main_navbar"
    aria-controls="main_navbar"
    aria-expanded="false"
    aria-label="{{ T "ui_toggle_navigation" | default "Toggle navigation" }}">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse td-navbar-nav-scroll ml-xl-auto" id="main_navbar">
    <button
      class="btn td-navbar-drawer-close d-md-none"
      type="button"
      data-toggle="collapse"
      data-target="#main_navbar"
      aria-controls="main_navbar"
      aria-label="{{ T "ui_close_navigation" | default "Close navigation" }}">
      &times;
    </button>
    {{- /* In Docsy, the mt-2 class is used but that causes issues. This should be re-visited after 0.7 migration */ -}}
    <ul class="navbar-nav mt-2 mt-lg-0">
    {{ $p := . }}
    {{ range .Site.Menus.main }}
    <li class="nav-item mr-4 mb-2 mb-lg-0">
        {{ $active := or ($p.IsMenuCurrent "main" .) ($p.HasMenuCurrent "main" .) }}
        {{ with .Page }}
        {{ $active = or $active ( $.IsDescendant .)  }}
        {{ end }}
        {{ $pre := .Pre }}
        {{ $post := .Post }}
        {{ $url := urls.Parse .URL }}
        {{ $baseurl := urls.Parse $.Site.Params.Baseurl }}
        <a class="nav-link{{if $active }} active{{end}}" href="{{ with .Page }}{{ .RelPermalink }}{{ else }}{{ .URL | relLangURL }}{{ end }}" {{ if ne $url.Host $baseurl.Host }}target="_blank" {{ end }}>{{ with .Pre}}{{ $pre }}{{ end }}<span{{if $active }} class="active"{{end}}>{{ .Title }}</span>{{ with .Post}}{{ $post }}{{ end }}</a>
    </li>
    {{ end }}
    {{ if .Site.Params.versions -}}
      <li class="nav-item td-navbar-mobile-group d-md-none">
        <button class="nav-link td-navbar-mobile-group-toggle collapsed" type="button" data-toggle="collapse" data-target="#td-mobile-versions" aria-expanded="false" aria-controls="td-mobile-versions">
          <span>{{ T "version_menu" }}</span>
          <i class="fas fa-chevron-down" aria-hidden="true"></i>
        </button>
        <div id="td-mobile-versions" class="collapse td-navbar-mobile-group-menu" data-parent="#main_navbar">
          <a class="td-navbar-mobile-group-item" href="{{ "releases" | relLangURL }}">{{ i18n "release_information_navbar" . }}</a>
          {{ range .Site.Params.versions }}
          <a class="td-navbar-mobile-group-item" href="{{ .url }}{{ $p.RelPermalink }}">{{ .version }}</a>
          {{ end }}
        </div>
      </li>
      <li class="nav-item dropdown mr-4 d-none d-lg-block">
        {{ partial "navbar-version-selector.html" . -}}
      </li>
    {{ end -}}
    {{ $langPage := cond (gt (len .Translations) 0) . .Site.Home -}}
    {{ if (gt (len .Site.Home.Translations) 0) -}}
      <li class="nav-item td-navbar-mobile-group d-md-none">
        <button class="nav-link td-navbar-mobile-group-toggle" type="button" data-toggle="collapse" data-target="#td-mobile-languages" aria-expanded="true" aria-controls="td-mobile-languages">
          <span>{{ $langPage.Language.LanguageName }}</span>
          <i class="fas fa-chevron-down" aria-hidden="true"></i>
        </button>
        <div id="td-mobile-languages" class="collapse show td-navbar-mobile-group-menu" data-parent="#main_navbar">
          {{ range $langPage.Translations }}
          <a class="td-navbar-mobile-group-item" href="{{ .RelPermalink }}">{{ .Language.LanguageName }}</a>
          {{ end }}
        </div>
      </li>
      <li class="nav-item dropdown mr-xl-4 d-none d-lg-block">
        {{ partial "navbar-lang-selector.html" . -}}
      </li>
    {{ end -}}
    </ul>
  </div>
  {{- /*
    The search bar is hidden for screen sizes 1500px or lower using CSS.
    We should look into using less hardcoded way of doing it.
  */ -}}
  <div class="navbar-nav d-none k8s-1500-block">
    {{ partial "search-input.html" . }}
  </div>
  <button
    class="td-navbar-drawer-backdrop d-md-none"
    type="button"
    data-toggle="collapse"
    data-target="#main_navbar"
    aria-controls="main_navbar"
    aria-label="{{ T "ui_close_navigation" | default "Close navigation" }}">
    <span class="sr-only">{{ T "ui_close_navigation" | default "Close navigation" }}</span>
  </button>
</nav>
