---
title: Agregar nodos worker de Windows
content_type: task
weight: 11
---

<!-- overview -->

{{< feature-state for_k8s_version="v1.18" state="beta" >}}

Esta página explica cómo agregar nodos worker de Windows a un clúster creado con kubeadm.

## {{% heading "prerequisites" %}}

* Una instancia en ejecución de [Windows Server 2022](https://www.microsoft.com/cloud-platform/windows-server-pricing)
(o superior) con acceso administrativo.
* Un clúster kubeadm en ejecución creado con `kubeadm init` y siguiendo los pasos
en el documento [Crear un clúster con kubeadm](/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/).

<!-- steps -->

## Agregar nodos worker de Windows

{{< note >}}
Para facilitar la adición de nodos worker de Windows a un clúster, se utilizan scripts de PowerShell del repositorio
https://sigs.k8s.io/sig-windows-tools.
{{< /note >}}

Haz lo siguiente para cada máquina:

1. Abre una sesión de PowerShell en la máquina.
1. Asegúrate de ser Administrador o un usuario con privilegios.

Luego continúa con los pasos que se indican a continuación.

### Instalar containerd

{{% thirdparty-content %}}

Para instalar containerd, primero ejecuta el siguiente comando:

  ```PowerShell
  curl.exe -LO https://raw.githubusercontent.com/kubernetes-sigs/sig-windows-tools/master/hostprocess/Install-Containerd.ps1
  ``````

Luego ejecuta el siguiente comando, pero primero reemplaza `CONTAINERD_VERSION` con una versión reciente
del [repositorio de containerd](https://github.com/containerd/containerd/releases).
La versión no debe tener el prefijo `v`. Por ejemplo, usa `1.7.22` en vez de `v1.7.22`:

  ```PowerShell
  .\Install-Containerd.ps1 -ContainerDVersion CONTAINERD_VERSION
  ```

* Ajusta cualquier otro parámetro de `Install-Containerd.ps1` como `netAdapterName` según lo necesites.
* Establece `skipHypervisorSupportCheck` si tu máquina no soporta Hyper-V y no puede alojar contenedores aislados por Hyper-V.
* Si cambias los parámetros opcionales `CNIBinPath` y/o `CNIConfigPath` de `Install-Containerd.ps1`, deberás
configurar el plugin CNI de Windows instalado con los mismos valores.

### Instalar kubeadm y kubelet

Ejecuta los siguientes comandos para instalar kubeadm y kubelet:

  ```PowerShell
  curl.exe -LO https://raw.githubusercontent.com/kubernetes-sigs/sig-windows-tools/master/hostprocess/PrepareNode.ps1
  .\PrepareNode.ps1 -KubernetesVersion v{{< skew currentVersion >}}
  ```

* Ajusta el parámetro `KubernetesVersion` de `PrepareNode.ps1` si es necesario.

### Ejecutar `kubeadm join`

Ejecuta el comando que fue generado por `kubeadm init`. Por ejemplo:

  ```bash
  kubeadm join --token <token> <control-plane-host>:<control-plane-port> --discovery-token-ca-cert-hash sha256:<hash>
  ```

#### Información adicional sobre kubeadm join

{{< note >}}
Para especificar una tupla IPv6 para `<control-plane-host>:<control-plane-port>`, la dirección IPv6 debe ir entre corchetes, por ejemplo: `[2001:db8::101]:2073`.
{{< /note >}}

Si no tienes el token, puedes obtenerlo ejecutando el siguiente comando en el nodo de control plane:

```bash
# Ejecuta esto en un nodo de control plane
sudo kubeadm token list
```

La salida será similar a esto:

```console
TOKEN                    TTL  EXPIRES              USAGES           DESCRIPTION            EXTRA GROUPS
8ewj1p.9r9hcjoqgajrj4gi  23h  2018-06-12T02:51:28Z authentication,  The default bootstrap  system:
                                                   signing          token generated by     bootstrappers:
                                                                    'kubeadm init'.        kubeadm:
                                                                                           default-node-token
```

Por defecto, los tokens de unión de nodos expiran después de 24 horas. Si vas a unir un nodo al clúster después de que el token actual haya expirado, puedes crear uno nuevo ejecutando el siguiente comando en el nodo de control plane:

```bash
# Ejecuta esto en un nodo de control plane
sudo kubeadm token create
```

La salida será similar a:

```console
5didvk.d09sbcov8ph2amjw
```

Si no tienes el valor de `--discovery-token-ca-cert-hash`, puedes obtenerlo ejecutando los siguientes comandos en el nodo de control plane:

```bash
sudo cat /etc/kubernetes/pki/ca.crt | openssl x509 -pubkey  | openssl rsa -pubin -outform der 2>/dev/null | \
   openssl dgst -sha256 -hex | sed 's/^.* //'
```

La salida será similar a:

```console
8cb2de97839780a412b93877f8507ad6c94f73add17d5d7058e91741c9d5ec78
```

La salida del comando `kubeadm join` debería verse algo así:

```
[preflight] Running pre-flight checks

... (log output of join workflow) ...

Node join complete:
* Certificate signing request sent to control-plane and response
  received.
* Kubelet informed of new secure connection details.

Run 'kubectl get nodes' on control-plane to see this machine join.
```

Unos segundos después, deberías ver este nodo en la salida de `kubectl get nodes`.
(por ejemplo, ejecuta `kubectl` en un nodo de control plane).

### Configuración de red

La configuración de CNI en clústeres mixtos con nodos Linux y Windows requiere más pasos que solo
ejecutar `kubectl apply` sobre un manifiesto. Además, el plugin CNI que se ejecuta en los nodos de control plane debe estar preparado para soportar el plugin CNI que se ejecuta en los nodos worker de Windows.

{{% thirdparty-content %}}

Solo algunos plugins CNI actualmente soportan Windows. A continuación puedes encontrar instrucciones individuales para ellos:
* [Flannel](https://sigs.k8s.io/sig-windows-tools/guides/flannel.md)
* [Calico](https://docs.tigera.io/calico/latest/getting-started/kubernetes/windows-calico/)

### Instalar kubectl para Windows (opcional) {#install-kubectl}

Consulta [Instalar y configurar kubectl en Windows](/docs/tasks/tools/install-kubectl-windows/).

## {{% heading "whatsnext" %}}

* Consulta cómo [agregar nodos worker de Linux](/docs/tasks/administer-cluster/kubeadm/adding-linux-nodes/).
