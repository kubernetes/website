---
title: Обмеження та резервування ID процесів
content_type: concept
weight: 40
---

<!-- overview -->

{{< feature-state for_k8s_version="v1.20" state="stable" >}}

Kubernetes дозволяє обмежувати кількість ідентифікаторів процесів (PID), які може використовувати {{< glossary_tooltip term_id="Pod" text="Pod" >}}. Також можна зарезервувати певну кількість доступних PID для кожного {{< glossary_tooltip term_id="node" text="вузла" >}} для використання операційною системою та службами (на відміну від Podʼів).

Ідентифікатори процесів (PID) є фундаментальним ресурсом на вузлах. Досить легко досягти обмеження на кількість завдань без досягнення будь-яких інших обмежень ресурсів, що може призвести до нестабільності роботи хосту.

Адміністраторам кластерів потрібні механізми, щоб гарантувати, що Podʼи, що працюють у кластері, не зможуть спричинити вичерпання PID, що перешкоджає роботі системних служб (таких як {{< glossary_tooltip text="kubelet" term_id="kubelet" >}} або {{< glossary_tooltip text="kube-proxy" term_id="kube-proxy" >}}), а також, можливо, і контейнерного середовища. Крім того, важливо забезпечити обмеження PID серед Podʼів, щоб гарантувати, що вони мають обмежений вплив на інші робочі навантаження на тому ж вузлі.

{{< note >}}
У деяких встановленнях Linux операційна система стандартно встановлює обмеження PID на низьке значення, наприклад, `32768`. Розгляньте можливість збільшення значення `/proc/sys/kernel/pid_max`.
{{< /note >}}

Ви можете налаштувати kubelet для обмеження кількості PID, які може споживати конкретний Pod. Наприклад, якщо ОС вашого вузла налаштовано на використання максимуму `262144` PID та очікується, що буде зберігатися менше `250` Podʼів, кожному Podʼу можна надати бюджет в розмірі `1000` PID, щоб запобігти використанню загальної кількості доступних PID на вузлі. Якщо адміністратор хоче надати можливість перевищення ліміту PID, схожий на CPU чи памʼять, він може зробити це, але з певними додатковими ризиками. У будь-якому випадку, одиничний Pod не зможе зруйнувати весь вузол. Цей вид обмеження ресурсів допомагає запобігти простим форк-бомбам впливати на роботу всього кластера.

Обмеження PID на рівні Pod дозволяє адміністраторам захистити один Pod від іншого, але не гарантує, що всі Podʼи, заплановані на цей вузол, не зможуть вплинути на вузол загалом. Обмеження PID на рівні Pod також не захищає системні агенти від вичерпання PID.

Ви також можете зарезервувати певну кількість PID для накладних витрат вузла, окремо від виділених для Podʼів. Це аналогічно тому, як ви можете резервувати CPU, памʼять чи інші ресурси для використання операційною системою та іншими засобами поза Podʼами та їх контейнерами.

Обмеження PID є важливим компонентом наряду з [ресурсами обчислення](/docs/concepts/configuration/manage-resources-containers/). Однак ви вказуєте його по-іншому: замість визначення ліміту ресурсу для Podʼів у `.spec` для Pod, ви налаштовуєте ліміт як параметр kubelet. Обмеження PID, визначене на рівні Podʼа, наразі не підтримується.

{{< caution >}}
Це означає, що обмеження, яке застосовується до Podʼа, може відрізнятися залежно від того, де запланований Pod. Щоб уникнути складнощів, найкраще, якщо всі вузли використовують однакові обмеження та резервування ресурсів PID.
{{< /caution >}}

## Обмеження PID вузла {#node-pid-limits}

Kubernetes дозволяє зарезервувати певну кількість ідентифікаторів процесів для системного використання. Для налаштування резервування використовуйте параметр `pid=<кількість>` у командних параметрах `--system-reserved` та `--kube-reserved` для kubelet. Зазначена вами кількість ідентифікаторів процесів оголошує, що вказана кількість ідентифікаторів процесів буде зарезервована для системи в цілому та для служб Kubernetes відповідно.

## Обмеження PID на рівні Podʼа {#pod-pid-limits}

Kubernetes дозволяє обмежити кількість процесів, які запущені в Podʼі. Ви вказуєте це обмеження на рівні вузла, а не налаштовуєте його як обмеження ресурсів для певного Podʼа. Кожен вузол може мати власний ліміт PID. Для налаштування ліміту ви можете вказати параметр командного рядка `--pod-max-pids` для kubelet або встановити `PodPidsLimit` в конфігураційному файлі kubelet.

## Виселення на основі PID {#pid-based-eviction}

Ви можете налаштувати kubelet для початку завершення роботи Podʼа, коли він працює некоректно та споживає аномальну кількість ресурсів. Ця функція називається виселення (eviction). Ви можете [Налаштувати обробку випадків нестачі ресурсів](/docs/concepts/scheduling-eviction/node-pressure-eviction/) для різних сигналів виселення. Використовуйте сигнал виселення `pid.available`, щоб налаштувати поріг кількості PID, використаних Podʼом. Ви можете встановити мʼякі та жорсткі політики виселення. Однак навіть з жорсткою політикою виселення, якщо кількість PID швидко зростає, вузол все ще може потрапити в нестабільний стан через досягнення обмеження PID вузла. Значення сигналу виселення обчислюється періодично і НЕ забезпечує його виконання.

Обмеження PID — на рівні Podʼа і вузла встановлює жорсткий ліміт. Як тільки ліміт буде досягнуто, робота почне стикатись з помилками при спробі отримати новий PID. Це може або не може призвести до перепланування Pod, залежно від того, як робоче навантаження реагує на ці помилки та як налаштовано проби на працездатність та готовність для Podʼа. Однак, якщо ліміти були налаштовані правильно, ви можете гарантувати, що інші робочі навантаження Podʼів та системні процеси не будуть вичерпувати PID, коли один Pod працює некоректно.

## {{% heading "whatsnext" %}}

- Дивіться [Покращеннями обмеження використання PID](https://github.com/kubernetes/enhancements/blob/097b4d8276bc9564e56adf72505d43ce9bc5e9e8/keps/sig-node/20190129-pid-limiting.md) для отримання додаткової інформації.
- Для історичного контексту прочитайте [Обмеження PID для покращення стабільності у Kubernetes 1.14](/blog/2019/04/15/process-id-limiting-for-stability-improvements-in-kubernetes-1.14/).
- Прочитайте [Управління ресурсами для контейнерів](/docs/concepts/configuration/manage-resources-containers/).
- Дізнайтеся, як [Налаштувати обробку випадків нестачі ресурсів](/docs/concepts/scheduling-eviction/node-pressure-eviction/).
