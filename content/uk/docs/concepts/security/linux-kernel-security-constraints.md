---
title: Обмеження безпеки ядра Linux для Podʼів та контейнерів
description: >
  Огляд модулів безпеки ядра Linux та обмежень, які можна використовувати для зміцнення вашого Podʼа та контейнерів.
content_type: concept
weight: 100
---

<!-- overview -->

Ця сторінка описує деякі з функцій безпеки, які вбудовані в ядро Linux і які ви можете використовувати у вашій роботі з Kubernetes. Щоб дізнатися, як застосувати ці функції до ваших Podʼів та контейнерів, див. [Налаштування контексту безпеки для Podʼа або контейнера](/docs/tasks/configure-pod-container/security-context/). Ви вже маєте бути знайомі з Linux та основами роботи з робочими навантаженням Kubernetes.

<!-- body -->

## Запуск робочих навантажень без привілеїв адміністратора {#run-without-root}

Коли ви розгортаєте робоче навантаження в Kubernetes, використовуйте специфікацію Podʼа, щоб обмежити це навантаження від можливості запуску від імені користувача root на вузлі. Ви можете використовувати `securityContext` Podʼа, щоб визначити конкретного користувача та групу Linux для процесів у Podʼі, і явно обмежувати контейнери від запуску користувачем root. Встановлення цих значень у маніфесті Podʼа переважає аналогічні значення в образі контейнера, що особливо корисно, якщо ви запускаєте образи, які не належать вам.

{{< caution >}}
Переконайтеся, що користувач або група, яку ви призначаєте робочому навантаженню, має необхідні дозволи для правильної роботи застосунку. Зміна користувача або групи на того, у якого немає необхідних дозволів, може призвести до проблем з доступом до файлів або збою операцій.
{{< /caution >}}

Налаштування функцій безпеки ядра на цій сторінці надає деталізоване керування діями, які можуть виконувати процеси у вашому кластері, проте управління цими налаштуваннями може бути складним у великому масштабі. Запуск контейнерів від імені не-root користувача, або у просторах імен користувачів, якщо вам потрібні привілеї адміністратора, допомагає зменшити ймовірність того, що вам доведеться застосовувати встановлені функції безпеки ядра.

## Функції безпеки в ядрі Linux {#linux-security-features}

Kubernetes дозволяє вам налаштовувати та використовувати функції ядра Linux для покращення ізоляції та зміцнення ваших робочих навантажень у контейнерах. Серед загальних функцій:

- **Безпечний режим обчислення (seccomp)**: Фільтруйте, які системні виклики може робити процес
- **AppArmor**: Обмежуйте привілеї доступу окремих програм
- **SELinux (Security Enhanced Linux)**: Назначайте мітки безпеки обʼєктам для простішого застосування політики безпеки

Для налаштування параметрів для однієї з цих функцій операційна система, яку ви обираєте для ваших вузлів, повинна увімкнути функцію у ядрі. Наприклад, Ubuntu 7.10 та пізніші версії стандартно увімкнені для AppArmor. Щоб дізнатися, чи увімкнено у вашій ОС певні функції, перегляньте документацію ОС.

Ви використовуєте поле `securityContext` у специфікації Podʼа, щоб визначити обмеження, які застосовуються до цих процесів. Поле `securityContext` також підтримує інші налаштування безпеки, такі як конкретні можливості Linux або дозволи на доступ до файлів за допомогою UID та GID. Докладніше див. [Налаштування контексту безпеки для Podʼа або контейнера](/docs/tasks/configure-pod-container/security-context/).

### seccomp

Деякі з ваших робочих навантажень можуть потребувати привілеїв для виконання певних дій від імені користувача root на хостовій машині вашого вузла. Linux використовує _можливості_ для розділення доступних привілеїв на категорії, щоб процеси могли отримати привілеї, необхідні для виконання певних дій без надання всіх привілеїв. Кожна можливість має набір системних викликів (syscalls), які може робити процес. seccomp дозволяє обмежувати ці окремі syscalls.<!--Скопійовано з підручника по seccomp--> Це може бути використано для ізоляції привілеїв процесу, обмежуючи виклики, які він може робити з простору користувача в ядро. <!--Кінець-->

У Kubernetes ви використовуєте _середовище виконання контейнерів_ на кожному вузлі для запуску ваших контейнерів. Прикладами середовища є CRI-O, Docker або containerd. Кожне середовище стандартно дозволяє лише певну підмножину можливостей Linux. Ви можете обмежити дозволені syscalls індивідуально за допомогою профілю seccomp. Зазвичай середовища виконання контейнерів містять стандартний профіль seccomp.<!--Скопійовано з підручника по seccomp--> Kubernetes дозволяє автоматично застосовувати профілі seccomp, завантажені на вузол, до ваших Podʼів та контейнерів.<!--Кінець-->

{{<note>}}
В Kubernetes також є налаштування `allowPrivilegeEscalation` для Podʼів та контейнерів. Якщо воно встановлене в `false`, це запобігає процесам отримувати нові можливості та обмежує непривілейованих користувачів у зміні застосованого профілю seccomp на більш дозвільний профіль.
{{</note>}}

Щоб дізнатись, як застосувати seccomp в Kubernetes, див. [Обмеження системних викликів контейнера за допомогою seccomp](/docs/tutorials/security/seccomp/) або [Довідку по вузлах Seccomp](/docs/reference/node/seccomp/).

Для отримання додаткової інформації про seccomp див. [Seccomp BPF](https://www.kernel.org/doc/html/latest/userspace-api/seccomp_filter.html) у документації ядра Linux.

#### Загальні положення щодо seccomp {#seccomp-considerations}

seccomp — це конфігурація безпеки на низькому рівні, яку ви маєте налаштувати тільки у разі потреби в детальному контролі над системними викликами Linux. Використання seccomp, особливо на великих масштабах, має наступні ризики:

- Конфігурації можуть ламатись під час оновлення програмного забезпечення
- Зловмисники все ще можуть використовувати дозволені syscalls для використання вразливостей
- Управління профілями для окремих застосунків стає складним на великих масштабах

**Рекомендація**: Використовуйте стандартний профіль seccomp, який поставляється разом із вашим середовищем виконання контейнерів. Якщо вам потрібна більш ізольоване середовище, розгляньте використання пісочниці, такої як gVisor. Пісочниці вирішують ризики, повʼязані з власними профілями seccomp, але вимагають більшого обсягу обчислювальних ресурсів на ваших вузлах та можуть мати проблеми сумісності з GPU та іншим спеціалізованим обладнанням.

### AppArmor та SELinux: політика обовʼязкового контролю доступу {#policy-based-mac}

Ви можете використовувати механізми політики обовʼязкового контролю доступу (MAC) Linux, такі як AppArmor та SELinux, для зміцнення ваших робочих навантажень у Kubernetes.

#### AppArmor

[AppArmor](https://apparmor.net/) — це модуль безпеки ядра Linux, який доповнює стандартні дозволи на основі прав користувачів та груп Linux для обмеження доступу програм до обмеженого набору ресурсів. AppArmor може бути налаштований для будь-якого застосунку з метою зменшення його потенційного периметру атаки та забезпечення глибшого захисту. Його налаштовують через профілі, настроєні на надання доступу, необхідного для конкретної програми або контейнера, такі як можливості Linux, мережевий доступ та дозволи на файли. Кожен профіль може працювати у режимі обовʼязкового виконання, який блокує доступ до заборонених ресурсів, або у режимі скарг, який лише реєструє порушення.

AppArmor може допомогти вам запустити більш безпечне розгортання, обмежуючи те, що контейнери мають право робити, або надавати кращі можливості аудиту через системні логи. Середовище виконання контейнерів, яке ви використовуєте, може поставлятися зі стандартним профілем AppArmor, або ви можете використовувати власний профіль.

Щоб дізнатись, як використовувати AppArmor у Kubernetes, див. [Обмеження доступу контейнера до ресурсів за допомогою AppArmor](/docs/tutorials/security/apparmor/).

#### SELinux

SELinu — це модуль безпеки ядра Linux, який дозволяє обмежувати доступ, який має певний _субʼєкт_, такий як процес, до файлів у вашій системі. Ви визначаєте політики безпеки, які застосовуються до субʼєктів з певними мітками SELinux. Коли процес, який має мітку SELinux, намагається отримати доступ до файлу, сервер SELinux перевіряє, чи дозволяє ця політика доступ та приймає рішення про авторизацію.

У Kubernetes ви можете встановити мітку SELinux у полі `securityContext` вашого маніфесту. Вказані мітки назначаються цим процесам. Якщо ви налаштували політики безпеки, які стосуються цих міток, ядро ОС хосту застосовує ці політики.

Щоб дізнатись, як використовувати SELinux у Kubernetes, див. [Призначення міток SELinux контейнеру](/docs/tasks/configure-pod-container/security-context/#assign-selinux-labels-to-a-container).

#### Різниця між AppArmor та SELinux {#apparmor-selinux-diff}

Операційна система на ваших вузлах Linux зазвичай містить один з механізмів захисту, або AppArmor, або SELinux. Обидва механізми забезпечують схожий тип захисту, але мають різниці, такі як:

- **Налаштування**: AppArmor використовує профілі для визначення доступу до ресурсів. SELinux використовує політики, які застосовуються до певних міток.
- **Застосування політики**: В AppArmor ви визначаєте ресурси за допомогою шляхів до файлів. SELinux використовує індексний вузол (inode) ресурсу для ідентифікації ресурсу.

### Підсумок функцій {#summary}

У таблиці нижче наведено використання та область застосування кожного контролю безпеки. Ви можете використовувати всі їх разом для створення більш захищеної системи.

<table>
  <caption>Підсумок функцій безпеки ядра Linux</caption>
  <thead>
    <tr>
      <th>Функція безпеки</th>
      <th>Опис</th>
      <th>Як використовувати</th>
      <th>Приклад</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>seccomp</td>
      <td>Обмежуйте окремі виклики ядра в просторі користувача. Зменшує ймовірність того, що вразливість, яка використовує обмежений системний виклик, скомпрометує систему.</td>
      <td>Вказуйте завантажений профіль seccomp у специфікації Podʼа або контейнера, щоб застосувати його обмеження до процесів у Podʼі.</td>
      <td>Відхиляйте системні виклики <code>unshare</code>, які використовувались у [CVE-2022-0185](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-0185).</td>
    </tr>
    <tr>
      <td>AppArmor</td>
      <td>Обмежуйте доступ програм до певних ресурсів. Зменшує поверхню атаки програми. Покращує аудит.</td>
      <td>Вкажіть завантажений профіль AppArmor у специфікації контейнера.</td>
      <td>Обмежити програму, яка працює тільки для читання, в записі будь-якого шляху до файлу у системі.</td>
    </tr>
    <tr>
      <td>SELinux</td>
      <td>Обмежуйте доступ до ресурсів, таких як файли, застосунки, порти та процеси за допомогою міток та політик безпеки.</td>
      <td>Вкажіть обмеження доступу для конкретних міток. Позначте процеси цими мітками, щоб застосувати обмеження доступу, повʼязані з міткою.</td>
      <td>Обмежити контейнер у доступі до файлів поза його власною файловою системою.</td>
    </tr>
  </tbody>
</table>

{{< note >}}
Механізми, такі як AppArmor та SELinux, можуть забезпечувати захист, який виходить за межі контейнера. Наприклад, ви можете використовувати SELinux для допомоги в запобіганні
[CVE-2019-5736](https://access.redhat.com/security/cve/cve-2019-5736).
{{< /note >}}

### Загальні відомості щодо керування власними конфігураціями {#considerations-custom-configurations}

seccomp, AppArmor та SELinux зазвичай мають стандартну конфігурацію, яка надає базовий захист. Ви також можете створити власні профілі та політики, які відповідають вимогам ваших робочих навантажень. Управління та розповсюдження цих власних конфігурацій на великому масштабі може бути складним, особливо якщо ви використовуєте всі три функції разом. Щоб допомогти вам керувати цими конфігураціями на великому масштабі, використовуйте інструмент, такий як
[Kubernetes Security Profiles Operator](https://github.com/kubernetes-sigs/security-profiles-operator).

## Функції безпеки на рівні ядра та привілейовані контейнери {#kernel-security-features-privileged-containers}

Kubernetes дозволяє вам вказувати, що деякі довірені контейнери можуть працювати у _привілейованому_ режимі. Будь-який контейнер у Podʼі може працювати у привілейованому режимі для використання адміністративних можливостей операційної системи, які інакше були б недоступні. Це доступно як для Windows, так і для Linux.

Привілейовані контейнери явно перевизначають деякі обмеження ядра Linux, які ви можливо використовуєте у ваших робочих навантаженнях, наступним чином:

- **seccomp**: Привілейовані контейнери працюють як профіль `Unconfined` seccomp, перевизначаючи будь-який профіль seccomp, який ви вказали у своєму маніфесті.
- **AppArmor**: Привілейовані контейнери ігнорують будь-які застосовані профілі AppArmor.
- **SELinux**: Привілейовані контейнери працюють як домен `unconfined_t`.

### Привілейовані контейнери {#privileged-containers}

<!-- Вміст з https://kubernetes.io/docs/concepts/workloads/pods/#privileged-mode-for-containers  -->

Будь-який контейнер у Podʼі може увімкнути _привілейований режим_, якщо ви встановите поле `privileged: true` у [`securityContext`](/docs/tasks/configure-pod-container/security-context/) поле для контейнера. Привілейовані контейнери перевизначають або скасовують багато інших налаштувань зміцнення захисту, таких як застосований профіль seccomp, профіль AppArmor або обмеження SELinux. Привілейовані контейнери отримують всі можливості Linux, включаючи можливості, яких їм не потрібно. Наприклад, користувач root у привілейованому контейнері може мати можливість використовувати можливості CAP_SYS_ADMIN та CAP_NET_ADMIN на вузлі, оминання конфігурації часу виконання seccomp та інших обмежень.

У більшості випадків ви повинні уникати використання привілейованих контейнерів і натомість надавати конкретні можливості, необхідні для вашого контейнера, використовуючи поле `capabilities` у полі `securityContext`. Використовуйте привілейований режим лише у випадках, коли у вас є можливість, яку ви не можете надати за допомогою securityContext. Це корисно для контейнерів, які хочуть використовувати адміністративні можливості операційної системи, такі як керування мережевим стеком або доступ до апаратного забезпечення.

У версії Kubernetes 1.26 та пізніше ви також можете запускати контейнери Windows у подібному привілейованому режимі, встановивши прапорець `windowsOptions.hostProcess` у контексті безпеки специфікації Podʼа. Для отримання докладної інформації та інструкцій див. [Створення Podʼа HostProcess для Windows](/docs/tasks/configure-pod-container/create-hostprocess-pod/).

## Рекомендації та поради {#recommendations-best-practices}

- Перш ніж налаштовувати можливості безпеки на рівні ядра, вам слід розглянути впровадження ізоляції на рівні мережі. Для отримання додаткової інформації прочитайте [Перелік заходів безпеки](/docs/concepts/security/security-checklist/#network-security).
- Крім того, якщо це необхідно, запускайте робочі навантаження Linux як непривілейовані, вказавши конкретні ідентифікатори користувача та групи у вашому маніфесті Podʼа та, вказавши `runAsNonRoot: true`.

Крім того, ви можете запускати робочі навантаження в просторах користувачів, встановивши `hostUsers: false` у вашому маніфесті Podʼа. Це дозволяє запускати контейнери від імені користувачів root у просторі користувачів, але як не-root користувача в просторі користувачів на вузлі. Це все ще знаходиться на ранніх етапах розробки та може не мати необхідного рівня підтримки, який вам потрібно. Для отримання інструкцій див. [Використання простору користувачів з Podʼом](/docs/tasks/configure-pod-container/user-namespaces/).

## {{% heading "whatsnext" %}}

- [Дізнайтеся, як використовувати AppArmor](/docs/tutorials/security/apparmor/)
- [Дізнайтеся, як використовувати seccomp](/docs/tutorials/security/seccomp/)
- [Дізнайтеся, як використовувати SELinux](/docs/tasks/configure-pod-container/security-context/#assign-selinux-labels-to-a-container)
- [Довідка по вузлах Seccomp](/docs/reference/node/seccomp/)
