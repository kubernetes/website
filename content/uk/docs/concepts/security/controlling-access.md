---
reviewers:
- erictune
- lavalamp
title: Керування доступом до API Kubernetes
content_type: concept
weight: 50
---

<!-- overview -->

Ця сторінка надає загальний огляд керування доступом до API Kubernetes.

<!-- body -->

Користувачі отримують доступ до [API Kubernetes](/docs/concepts/overview/kubernetes-api/) за допомогою `kubectl`, клієнтських бібліотек або за допомогою запитів REST. Як користувачі-люди, так і [облікові записи служб Kubernetes](/docs/tasks/configure-pod-container/configure-service-account/) можуть бути авторизовані для доступу до API. Коли запит досягає API, він проходить кілька етапів, які ілюструються на
наступній діаграмі:

![Діаграма етапів обробки запиту до API Kubernetes](/images/docs/admin/access-control-overview.svg)

## Транспортна безпека {#transport-security}

Стандартно сервер API Kubernetes прослуховує порт 6443 на першому нелокальному мережевому інтерфейсі, захищеному за допомогою TLS. У типовому промисловому кластері Kubernetes, API працює на порту 443. Порт можна змінити за допомогою прапорця `--secure-port`, а  IP-адресу прослуховування – за допомогою `--bind-address`.

Сервер API представляє сертифікат. Цей сертифікат може бути підписаний за допомогою приватного центру сертифікації (ЦС), або на основі інфраструктури відкритих ключів, повʼязаної з загалом визнаним ЦС. Сертифікат та відповідний приватний ключ можна встановити за допомогою прапорців `--tls-cert-file` та `--tls-private-key-file`.

Якщо ваш кластер використовує приватний ЦС, вам потрібна копія цього сертифіката ЦС, налаштована в вашому `~/.kube/config` на клієнті, щоб ви могли довіряти зʼєднанню і бути впевненими, що воно не було перехоплено.

На цьому етапі ваш клієнт може представити сертифікат клієнта TLS.

## Автентифікація {#authentication}

Якщо TLS-зʼєднання встановлено, HTTP-запит переходить до кроку автентифікації. Це показано як крок **1** на діаграмі. Скрипт створення кластера або адміністратор кластера налаштовує сервер API на виконання одного або декількох модулів автентифікації. Модулі автентифікації детально описані в документації про [Автентифікацію](/docs/reference/access-authn-authz/authentication/).

Вхідними даними для кроку автентифікації є весь HTTP-запит; проте, зазвичай перевіряються заголовки та/або сертифікат клієнта.

Модулі автентифікації включають клієнтські сертифікати, паролі та прості токени, токени ініціалізації та токени JSON Web Tokens (використовується для облікових записів служб).

Можна вказати кілька модулів автентифікації, при цьому кожен з них використовується послідовно, доки спроба не буде успішною.

Якщо запит не може бути автентифікований, він буде відхилений з HTTP-статусом 401. Інакше користувач автентифікується як конкретний `username`, та імʼя користувача доступне для наступних кроків для використання у їхніх рішеннях. Деякі автентифікатори також надають групові приналежності користувача, в той час, як інші автентифікатори цього не роблять.

Хоча Kubernetes використовує імена користувачів для прийняття рішень про контроль доступу та в логах запитів, в нього немає обʼєкта `User`, і він не зберігає імена користувачів чи іншу інформацію про користувачів у своєму API.

## Авторизація {#authorization}

Після того як запит автентифікується як такий, що надійшов від певного користувача, йому потрібно пройти авторизацію. Це показано як крок **2** на діаграмі.

Запит повинен містити імʼя користувача, який робить запит, запитану дію та обʼєкт, на якому відбувається дія. Запит авторизується, якщо наявна політика вказує, що користувач має дозвіл на виконання запитаної дії.

Наприклад, якщо у Боба є така політика, то він може лише читати обʼєкти у просторі імен `projectCaribou`:

```json
{
    "apiVersion": "abac.authorization.kubernetes.io/v1beta1",
    "kind": "Policy",
    "spec": {
        "user": "bob",
        "namespace": "projectCaribou",
        "resource": "pods",
        "readonly": true
    }
}
```

Якщо Боб зробить такий запит, то він буде авторизований, оскільки він має дозвіл на читання об'єктів у просторі імен `projectCaribou`:

```json
{
  "apiVersion": "authorization.k8s.io/v1beta1",
  "kind": "SubjectAccessReview",
  "spec": {
    "resourceAttributes": {
      "namespace": "projectCaribou",
      "verb": "get",
      "group": "unicorn.example.org",
      "resource": "pods"
    }
  }
}
```

Якщо Боб зробить запит на запис (`create` або `update`) обʼєктів у просторі імен
`projectCaribou`, то йому буде відмовлено в авторизації. Якщо Боб зробить запит на
читання (`get`) обʼєктів у іншому просторі імен, наприклад, `projectFish`, то йому
буде відмовлено в авторизації.

Для авторизації в Kubernetes потрібно використовувати загальні атрибути REST для взаємодії з наявними системами керування доступом на рівні всієї організації або постачальника хмарних послуг. Важливо використовувати форматування REST, оскільки ці системи керування можуть взаємодіяти з іншими API, крім API Kubernetes.

Kubernetes підтримує кілька модулів авторизації, таких як режим ABAC, режим RBAC та режим Webhook. Коли адміністратор створює кластер, він налаштовує модулі авторизації, які повинні використовуватися в сервері API. Якщо налаштовано більше одного модуля авторизації, Kubernetes перевіряє кожен модуль, і якщо будь-який модуль авторизує запит, то запит може бути виконаний. Якщо всі модулі відхиляють запит, то запит відхиляється (HTTP-статус код 403).

Щоб дізнатися більше про авторизацію в Kubernetes, включно з деталями щодо створення політик з використанням підтримуваних модулів авторизації, див. [Авторизація](/docs/reference/access-authn-authz/authorization/).

## Контроль доступу {#admission-control}

Модулі контролю доступу — це програмні модулі, які можуть змінювати або відхиляти запити. Крім атрибутів, доступних модулям авторизації, модулі контролю доступу можуть отримувати доступ до вмісту обʼєкта, який створюється або змінюється.

Контролери доступу діють на запити, які створюють, змінюють, видаляють або підключаються (проксі) до обʼєкта. Контролери доступу не діють на запити, які лише читають обʼєкти. Коли налаштовано кілька контролерів доступу, вони викликаються по черзі.

Це показано як крок **3** на діаграмі.

На відміну від модулів автентифікації та авторизації, якщо будь-який модуль контролю доступу відхиляє запит, то запит негайно відхиляється.

Крім відхилення обʼєктів, контролери доступу також можуть встановлювати складні стандартні значення для полів.

Доступні модулі контролю доступу описані в [Контролерах доступу](/docs/reference/access-authn-authz/admission-controllers/).

Після того як запит пройшов усі контролери доступу, він перевіряється за допомогою процедур валідації для відповідного обʼєкта API, і потім записується в сховище обʼєктів (показано як крок **4**).

## Аудит {#auditing}

Аудит Kubernetes забезпечує безпеку, хронологічний набір записів, що документують послідовність дій у кластері. Кластер аудитує активності, що генеруються користувачами, застосунками, які використовують API Kubernetes, і самою панелі управління.

Для отримання додаткової інформації див. [Аудит](/docs/tasks/debug/debug-cluster/audit/).

## {{% heading "whatsnext" %}}

Прочитайте додаткову документацію щодо автентифікації, авторизації та контролю доступу до API:

- [Автентифікація](/docs/reference/access-authn-authz/authentication/)
   - [Автентифікація за допомогою Bootstrap Token](/docs/reference/access-authn-authz/bootstrap-tokens/)
- [Контролери допуску](/docs/reference/access-authn-authz/admission-controllers/)
   - [Динамічний контроль допуску](/docs/reference/access-authn-authz/extensible-admission-controllers/)
- [Авторизація](/docs/reference/access-authn-authz/authorization/)
   - [Контроль доступу на основі ролей](/docs/reference/access-authn-authz/rbac/)
   - [Контроль доступу на основі атрибутів](/docs/reference/access-authn-authz/abac/)
   - [Авторизація вузлів](/docs/reference/access-authn-authz/node/)
   - [Авторизація вебхукками](/docs/reference/access-authn-authz/webhook/)
- [Запити на підписання сертифікатів](/docs/reference/access-authn-authz/certificate-signing-requests/)
   - включаючи [схвалення запитів на підписання сертифікатів](/docs/reference/access-authn-authz/certificate-signing-requests/#approval-rejection) та [підписання сертифікатів](/docs/reference/access-authn-authz/certificate-signing-requests/#signing)
- Сервісні облікові записи
  - [Керівництво розробника](/docs/tasks/configure-pod-container/configure-service-account/)
  - [Адміністрування](/docs/reference/access-authn-authz/service-accounts-admin/)

Ви можете дізнатися про:
- як Podʼи можуть використовувати [Secret](/docs/concepts/configuration/secret/#service-accounts-automatically-create-and-attach-secrets-with-api-credentials) для отримання API-даних для доступу.
