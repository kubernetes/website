---
title: Організація доступу до кластеру за допомогою файлів kubeconfig
content_type: concept
weight: 60
---

<!-- overview -->

Використовуйте файли kubeconfig для організації інформації про кластери, користувачів, простори імен та механізми автентифікації. `kubectl` використовує файли kubeconfig, щоб знайти інформацію, необхідну для вибору кластера та звʼязку з сервером API кластера.

{{< note >}}
Файл, який використовується для налаштування доступу до кластерів, називається *файлом kubeconfig*. Це загальний спосіб посилання на файли конфігурації. Це не означає, що існує файл з іменем `kubeconfig`.
{{< /note >}}

{{< warning >}}
Використовуйте файли kubeconfig лише з надійних джерел. Використання спеціально створеного файлу kubeconfig може призвести до виконання зловмисного коду або розголошення файлів. Якщо вам все ж потрібно використовувати ненадійний файл kubeconfig, уважно перевірте його, так само як ви це зробили б з файлом скрипту оболонки.
{{< /warning >}}

Типово `kubectl` шукає файл з імʼям `config` у каталозі `$HOME/.kube`. Ви можете вказати інші файли kubeconfig, встановивши змінну середовища `KUBECONFIG` або встановивши прапорець [`--kubeconfig`](/docs/reference/generated/kubectl/kubectl/).

Для покрокових інструкцій щодо створення та вказівки файлів kubeconfig див. [Налаштування доступу до кількох кластерів](/docs/tasks/access-application-cluster/configure-access-multiple-clusters).

<!-- body -->

## Підтримка кількох кластерів, користувачів та механізмів автентифікації {#supporting-multiple-clusters-users-and-authentication-mechanisms}

Припустимо, у вас є декілька кластерів, і ваші користувачі та компоненти автентифікуються різними способами. Наприклад:

- Робочий kubelet може автентифікуватися за допомогою сертифікатів.
- Користувач може автентифікуватися за допомогою токенів.
- Адміністратори можуть мати набори сертифікатів, які вони надають окремим користувачам.

За допомогою файлів kubeconfig ви можете організувати ваші кластери, користувачів та простори імен. Ви також можете визначити контексти, щоб швидко та легко перемикатися між кластерами та просторами імен.

## Контекст {#context}

Елемент *context* в файлі kubeconfig використовується для групування параметрів доступу під зручною назвою. Кожен контекст має три параметри: кластер, простір імен та користувач. Типово, інструмент командного рядка `kubectl` використовує параметри з *поточного контексту* для звʼязку з кластером.

Щоб обрати поточний контекст:

```shell
kubectl config use-context
```

## Змінна середовища KUBECONFIG {#the-environment-variable-kubeconfig}

Змінна середовища `KUBECONFIG` містить список файлів kubeconfig. Для Linux та Mac список розділяється двокрапкою. Для Windows список розділяється крапкою з комою. Змінна середовища `KUBECONFIG` не є обовʼязковою. Якщо змінна середовища `KUBECONFIG` не існує, `kubectl` використовує стандартний файл kubeconfig, `$HOME/.kube/config`.

Якщо змінна середовища `KUBECONFIG` існує, `kubectl` використовує ефективну конфігурацію, яка є результатом обʼєднання файлів, перерахованих у змінній середовища `KUBECONFIG`.

## Обʼєднання файлів kubeconfig {#merging-kubeconfig-files}

Щоб переглянути вашу конфігурацію, введіть цю команду:

```shell
kubectl config view
```

Як описано раніше, вихідні дані можуть бути з одного файлу kubeconfig або бути результатом обʼєднання кількох файлів kubeconfig.

Ось правила, які використовує `kubectl` під час обʼєднання файлів kubeconfig:

1. Якщо встановлено прапорець `--kubeconfig`, використовуйте лише вказаний файл. Обʼєднання не здійснюється. Дозволяється лише один екземпляр цього прапорця.

   У іншому випадку, якщо встановлена змінна середовища `KUBECONFIG`, використовуйте її як список файлів, які потрібно обʼєднати. Обʼєднайте файли, перераховані у змінній середовища `KUBECONFIG`, згідно з наступними правилами:

   - Ігноруйте порожні імена файлів.
   - Виводьте помилки для файлів з вмістом, який не може бути десеріалізований.
   - Перший файл, що встановлює певне значення або ключ зіставлення, має перевагу.
   - Ніколи не змінюйте значення або ключ зіставлення. Наприклад: Зберігайте контекст першого файлу, який встановлює `current-context`. Наприклад: Якщо два файли вказують на `red-user`, використовуйте лише значення з `red-user` першого файлу. Навіть якщо другий файл має несумісні записи під `red-user`, відкиньте їх.

   Для прикладу встановлення змінної середовища `KUBECONFIG` дивіться [Встановлення змінної середовища KUBECONFIG](/docs/tasks/access-application-cluster/configure-access-multiple-clusters/#set-the-kubeconfig-environment-variable).

   В іншому випадку використовуйте стандартний файл kubeconfig, `$HOME/.kube/config`, без обʼєднання.

2. Визначте контекст, який буде використовуватися на основі першого збігу в цьому ланцюжку:

    1. Використовуйте прапорець командного рядка `--context`, якщо він існує.
    2. Використовуйте `current-context` з обʼєднаних файлів kubeconfig.

   Порожній контекст допускається на цьому етапі.

3. Визначте кластер та користувача. На цьому етапі може бути або не бути контексту. Визначте кластер та користувача на основі першого збігу в цьому ланцюжку, який запускається двічі: один раз для користувача та один раз для кластера:

   1. Використовуйте прапорці командного рядка, якщо вони існують: `--user` або `--cluster`.
   2. Якщо контекст не порожній, беріть користувача або кластер з контексту.

   Користувач та кластер можуть бути порожніми на цьому етапі.

4. Визначте фактичну інформацію про кластер, яку слід використовувати. На цьому етапі може бути або не бути інформації про кластер. Побудуйте кожен елемент інформації про кластер на основі цього ланцюжка; перший збіг перемагає:

   1. Використовуйте прапорці командного рядка, якщо вони існують: `--server`, `--certificate-authority`, `--insecure-skip-tls-verify`.
   2. Якщо існують будь-які атрибути інформації про кластер з обʼєднаних файлів kubeconfig, використовуйте їх.
   3. Якщо немає розташування сервера, відмовтеся.

5. Визначте фактичну інформацію про користувача, яку слід використовувати. Побудуйте інформацію про користувача, використовуючи ті ж правила, що і для інформації про кластер, за винятком того, що дозволяється лише одна техніка автентифікації для кожного користувача:

   1. Використовуйте прапорці командного рядка, якщо вони існують: `--client-certificate`, `--client-key`, `--username`, `--password`, `--token`.
   2. Використовуйте поля `user` з обʼєднаних файлів kubeconfig.
   3. Якщо є дві суперечливі техніки, відмовтеся.

6. Для будь-якої інформації, що все ще відсутня, використовуйте стандартні значення  і, можливо, запитайте інформацію для автентифікації.

## Посилання на файли {#file-references}

Посилання на файли та шляхи в файлі kubeconfig є відносними до місця розташування файлу kubeconfig. Посилання на файли в командному рядку є відносними до поточного робочого каталогу. У файлі `$HOME/.kube/config` відносні шляхи зберігаються відносно, абсолютні шляхи зберігаються абсолютно.

## Проксі {#proxy}

Ви можете налаштувати `kubectl` використовувати проксі для кожного кластера за допомогою `proxy-url` у вашому файлі kubeconfig, на зразок такого:

```yaml
apiVersion: v1
kind: Config

clusters:
- cluster:
    proxy-url: http://proxy.example.org:3128
    server: https://k8s.example.org/k8s/clusters/c-xxyyzz
  name: development

users:
- name: developer

contexts:
- context:
  name: development
```

## {{% heading "whatsnext" %}}

- [Налаштування доступу до кількох кластерів](/docs/tasks/access-application-cluster/configure-access-multiple-clusters/)
- [`kubectl config`](/docs/reference/generated/kubectl/kubectl-commands#config)
