---
min-kubernetes-server-version: v1.33
title: Переконфігурація стандартного ServiceCIDR Kubernetes
content_type: task
---

<!-- overview -->
{{< feature-state feature_gate_name="MultiCIDRServiceAllocator" >}}

У цьому документі описано, як переналаштувати стандартний діапазон IP-адрес Service, призначених кластеру.

## {{% heading "prerequisites" %}}

{{< include "task-tutorial-prereqs.md" >}}

{{< version-check >}}

<!-- steps -->

## Переналаштування стандартного ServiceCIDR Kubernetes {#kubernetes-default-servicecidr-reconfiguration}

У цьому документі пояснюється, як керувати діапазоном IP-адрес Service у кластері Kubernetes, який також впливає на підтримувані кластером сімейства IP-адрес для Service.

Сімейства IP-адрес, доступні для Service ClusterIP-адрес, визначаються прапорцем `--service-cluster-ip-range` у kube-apiserver. Для кращого розуміння розподілу IP-адрес Сервісів зверніться до документації [Відстеження розподілу IP-адрес Сервісів](/docs/reference/networking/virtual-ips/#ip-address-objects).

Починаючи з Kubernetes 1.33, сімейства IP-адрес Service, налаштовані для кластера, відображаються обʼєктом ServiceCIDR з іменем `kubernetes`. Обʼєкт ServiceCIDR `kubernetes` створюється першим екземпляром kube-apiserver, який запускається, на основі налаштованого прапорця `--service-cluster-ip-range`. Для забезпечення узгодженої поведінки кластера всі екземпляри kube-apiserver мають бути налаштовані з однаковими значеннями `--service-cluster-ip-range`, які мають відповідати стандартному обʼєкту ServiceCIDR `kubernetes`.

### Категорії реконфігурації Kubernetes ServiceCIDR {#kubernetes-servicecidr-reconfiguration-categories}

Ми можемо класифікувати реконфігурацію ServiceCIDR за наступними сценаріями:

* **Розширення наявних ServiceCIDR:** Це можна зробити динамічно, додавши нові обʼєкти ServiceCIDR без необхідності переконфігурації kube-apiserver. Будь ласка, зверніться до відповідної документації щодо [Розширення діапазонів IP-адрес Service](/docs/tasks/network/extend-service-ip-ranges/).

* **Перетворення з одного стека на два зі збереженням первинного ServiceCIDR:** Це передбачає введення другого сімейства IP-адрес (IPv6 у кластер, що використовує лише IPv4, або IPv4 у кластер, що використовує лише IPv6), при цьому первинне сімейство IP-адрес залишається первинним. Це вимагає оновлення конфігурації kube-apiserver і відповідної модифікації різних компонентів кластера, які повинні працювати з цим додатковим сімейством IP. Ці компоненти включають, але не обмежуються ними, kube-proxy, CNI або мережевий втулок, реалізації сервісних мереж та DNS-сервіси.

* **Перетворення з подвійного на одинарний зі збереженням первинного ServiceCIDR:** Це передбачає видалення вторинного сімейства IP з двостекового кластера, повернення до єдиного сімейства IP зі збереженням початкового первинного сімейства IP. На додачу до реконфігурації компонентів відповідно до нового сімейства IP, вам може знадобитися звернутися до Services, які були явно налаштовані на використання видаленого сімейства IP.

* **Усе, що призводить до зміни первинного ServiceCIDR:** Повна заміна стандартного ServiceCIDR є складною операцією. Якщо новий ServiceCIDR не перетинається з наявним, [це вимагатиме перенумерації всіх наявних Services і зміни Service `kubernetes.default`](#illustrative-reconfiguration-steps). Випадок, коли змінюється первинне сімейство IP-адрес, є ще складнішим і може вимагати зміни декількох компонентів кластера (kubelet, мережеві втулки тощо), щоб вони відповідали новому первинному сімейству IP-адрес.

### Ручні операції для заміни стандартного ServiceCIDR {#manual-operations-for-replacing-the-default-servicecidr}

Переналаштування стандартного ServiceCIDR потребує ручних дій з боку оператора кластера, адміністратора або програмного забезпечення, що керує життєвим циклом кластера. Зазвичай вони включають в себе наступні дії:

1. **Оновлення** конфігурації kube-apiserver: Змініть прапорець `--service-cluster-ip-range` новим діапазоном (діапазонами) IP-адрес.
2. **Переналаштування** мережевих компонентів: Це дуже важливий крок, і конкретна процедура залежить від різних мережевих компонентів, що використовуються. Вона може включати оновлення конфігураційних файлів, перезапуск агентів або оновлення компонентів для керування новими ServiceCIDR і бажаною конфігурацією сімейства IP-адрес для Podʼів. Типовими компонентами можуть бути реалізація Сервісів Kubernetes, таких як kube-proxy, і налаштований мережевий втулок, а також потенційно інші мережеві компоненти, такі як контролери сервісних мереж і DNS-сервери, щоб переконатися, що вони можуть коректно обробляти трафік і виконувати виявлення сервісів з новою конфігурацією сімейства IP-адрес.
3. **Керування наявними Сервісами:** Сервіси з IP-адресами зі старого CIDR мають бути адресовані, якщо вони не входять до нових налаштованих діапазонів. Варіанти включають відновлення (що призводить до простою і нових призначень IP-адрес) або потенційно складніші стратегії реконфігурації.
4. **Повторне створення внутрішніх сервісів Kubernetes:** Сервіс `kubernetes.default` необхідно видалити та створити заново, щоб отримати IP-адресу з нового ServiceCIDR, якщо первинне сімейство IP-адрес змінено або замінено на іншу мережу.

### Ілюстративні кроки реконфігурації {#illustrative-reconfiguration-steps}

Наступні кроки описують контрольовану реконфігурацію, зосереджену на повній заміні стандартного ServiceCIDR і перестворенні Service `kubernetes.default`:

1. Запустіть kube-apiserver з початковим `--service-cluster-ip-range`.
2. Створіть початкові Сервіси, які отримують IP з цього діапазону.
3. Створіть новий ServiceCIDR як тимчасову ціль для реконфігурації.
4. Позначте стандартний ServiceCIDR `kubernetes` для видалення (він залишиться в очікуванні через наявні IP-адреси та завершувачі). Це запобігає новим розподілам зі старого діапазону.
5. Повторно створіть наявні Сервіси. Тепер їм мають бути виділені IP-адреси з нового, тимчасового ServiceCIDR.
6. Перезапустіть kube-apiserver з налаштованими новими ServiceCIDR і вимкніть старий екземпляр.
7. Видаліть сервіс `kubernetes.default`. Новий kube-apiserver відтворить його у новому ServiceCIDR.

## {{% heading "whatsnext" %}}

* [Мережеві концепції Kubernetes](/docs/concepts/cluster-administration/networking/)
* [Двостекові Сервіси Kubernetes](/docs/concepts/services-networking/dual-stack/)
* [Розширення діапазонів IP-адрес сервісів Kubernetes](/docs/tasks/network/extend-service-ip-ranges/)
