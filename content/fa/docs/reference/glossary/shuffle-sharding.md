---
title: Shuffle-sharding
id: shuffle-sharding
date: 2020-03-04
full_link:
short_description: >
  روشی برای تخصیص درخواست‌ها به صف‌ها که ایزوله‌سازی بهتری نسبت به «هش باقیمانده به تعداد صف‌ها» فراهم می‌کند.

aka:
tags:
- fundamental
---
 روشی برای تخصیص درخواست‌ها به صف‌ها که ایزوله‌سازی بهتری نسبت به «هش باقیمانده به تعداد صف‌ها» فراهم می‌کند.

<!--more--> 

اغلب دغدغه ما جداسازی جریان‌های مختلفِ درخواست از یکدیگر است تا یک جریان پُرشدت نتواند جریان‌های کم‌شدت را از میدان به در کند.  
یک راه ساده برای قرار دادن درخواست‌ها در صف‌ها آن است که برخی ویژگی‌های درخواست را هش کرده و باقیمانده تقسیم بر تعداد صف‌ها را به‌عنوان شاخص صف به کار گیریم. تابع هش، ویژگی‌هایی از درخواست را دریافت می‌کند که با جریان‌های ترافیک همسو هستند؛ برای نمونه در اینترنت معمولاً ۵‌تاییِ نشانی مبدأ و مقصد، پروتکل، و پورت مبدأ و مقصد استفاده می‌شود.

این طرح ساده مبتنی بر هش چنین خاصیتی دارد که هر جریان پُرشدت، تمام جریان‌های کم‌شدتِ هَش‌شده به همان صف را کنار می‌زند. برای ایزوله‌سازی مناسب تعداد زیادی جریان، به تعداد زیادی صف نیاز است که دردسرساز است. شافل‌شاردینگ تکنیکی چابک‌تر است که می‌تواند جریان‌های کم‌شدت را بهتر از جریان‌های پُرشدت جدا کند. در اصطلاح شافل‌شاردینگ از استعاره «تقسیم یک دست ورق از یک دسته کارت» بهره می‌برد؛ هر صف یک «کارت» استعاری است. این تکنیک با هش‌کردن ویژگی‌های شناسایی جریان آغاز می‌شود تا یک مقدار هش با ده‌ها بیت یا بیشتر تولید کند. سپس از این مقدار هش به‌عنوان منبع تصادفی برای «بر زدن» دسته و «دادن» یک دست کارت (صف) استفاده می‌شود. همه صف‌های داده‌شده بررسی می‌شوند و درخواست در یکی از صف‌های بررسی‌شده با کوتاه‌ترین طول قرار می‌گیرد.

با اندازه دستِ نسبتاً کوچک، بررسی همه کارت‌های داده‌شده هزینه زیادی ندارد و یک جریان کم‌شدت شانس خوبی دارد که از تأثیر یک جریان پُرشدت بگریزد. با اندازه دست بزرگ، بررسی صف‌های داده‌شده هزینه‌بر است و برای جریان‌های کم‌شدت دشوارتر می‌شود که از اثر جمعیِ مجموعه‌ای از جریان‌های پُرشدت بگریزند. بنابراین، اندازه دست باید با دقت انتخاب شود.
