---
title: ローカル一時ストレージ (Local Ephemeral Storage)
content_type: concept
weight: 95
---

ノードにはローカル一時ストレージがあります。これは、ローカルに接続された書き込み可能なデバイス、または場合によっては RAM によって提供されます。
「一時的（Ephemeral）」とは、長期的な耐久性が保証されていないことを意味します。

Pod は、一時的な作業領域、キャッシュ、およびログのためにローカル一時ストレージを使用します。
kubelet は、ローカル一時ストレージを使用して、Pod に
[`emptyDir`](/docs/concepts/storage/volumes/#emptydir)
{{< glossary_tooltip term_id="volume" text="ボリューム" >}}
をコンテナにマウントすることで作業領域を提供できます。

kubelet はまた、この種のストレージを使用して、
[ノードレベルのコンテナログ](/docs/concepts/cluster-administration/logging/#logging-at-the-node-level)、
コンテナイメージ、および実行中のコンテナの書き込み可能レイヤーを保持します。

{{< caution >}}
ノードが障害を起こした場合、そのノード上の一時ストレージ内のデータは失われる可能性があります。
アプリケーションは、ローカル一時ストレージに対して
パフォーマンス SLA（ディスク IOPS など）を期待することはできません。
{{< /caution >}}

{{< note >}}
一時ストレージに対してリソースクォータを有効にするには、次の 2 つが必要です。

* 管理者が、名前空間に対して ephemeral-storage のリソースクォータを設定する
* ユーザーが Pod の仕様で ephemeral-storage リソースの制限を指定する

ユーザーが Pod 仕様で ephemeral-storage の制限を指定しない場合、
一時ストレージに対するリソースクォータは適用されません。
{{< /note >}}

Kubernetes では、Pod が消費できるローカル一時ストレージの量を
追跡、予約、および制限できます。

## ローカル一時ストレージの構成 {#configurations}

Kubernetes は、ノード上でローカル一時ストレージを構成するために
次の 2 つの方法をサポートしています。

{{< tabs name="local_storage_configurations" >}}

{{% tab name="単一ファイルシステム" %}}
この構成では、すべての種類のローカル一時データ
（`emptyDir` ボリューム、書き込み可能レイヤー、コンテナイメージ、ログ）
を 1 つのファイルシステムに配置します。

最も効果的な kubelet の構成方法は、このファイルシステムを
Kubernetes（kubelet）データ専用にすることです。

kubelet はまた、
[ノードレベルのコンテナログ](/docs/concepts/cluster-administration/logging/#logging-at-the-node-level)
を書き込み、これらをローカル一時ストレージと同様に扱います。

kubelet は、設定されたログディレクトリ（デフォルトでは `/var/log`）
にログを書き込み、他のローカルデータ用のベースディレクトリ
（デフォルトでは `/var/lib/kubelet`）を持ちます。

通常、`/var/lib/kubelet` と `/var/log` の両方は
システムのルートファイルシステム上にあり、
kubelet はこのレイアウトを前提として設計されています。

Kubernetes に使用されない他のファイルシステムを、
ノードにいくつでも持つことができます。
{{% /tab %}}

{{% tab name="2 つのファイルシステム" %}}
この構成では、実行中の Pod から生成される
一時データ（ログや `emptyDir` ボリューム）用のファイルシステムを使用します。
このファイルシステムは、Kubernetes に関連しない
他のデータ（システムログなど）にも使用できます。
ルートファイルシステムであっても問題ありません。

kubelet は、
[ノードレベルのコンテナログ](/docs/concepts/cluster-administration/logging/#logging-at-the-node-level)
も最初のファイルシステムに書き込み、
これらをローカル一時ストレージとして扱います。

さらに、別の論理ストレージデバイスによりバックアップされた
2 番目のファイルシステムを使用します。
この構成では、コンテナイメージレイヤーおよび
書き込み可能レイヤーを配置するディレクトリを
この 2 番目のファイルシステムに設定します。

最初のファイルシステムには、
イメージレイヤーや書き込み可能レイヤーは含まれません。

Kubernetes に使用されない他のファイルシステムを、
ノードにいくつでも持つことができます。
{{% /tab %}}

{{< /tabs >}}

kubelet は、サポートされている構成のいずれかを使用して
ノードが設定されている場合に限り、
ローカルストレージの使用量を測定できます。

異なる構成を使用している場合、
kubelet はローカル一時ストレージに対して
リソース制限を適用しません。

{{< note >}}
kubelet は、`tmpfs` の `emptyDir` ボリュームを
ローカル一時ストレージではなく、
コンテナメモリ使用量として追跡します。
{{< /note >}}

{{< note >}}
kubelet は、一時ストレージの追跡対象として
ルートファイルシステムのみを使用します。
`/var/lib/kubelet` や `/var/lib/containers` を
別ディスクにマウントする OS レイアウトでは、
一時ストレージが正しく報告されません。
{{< /note >}}
