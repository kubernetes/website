---
title: Kubernetesオブジェクト管理
content_type: concept
weight: 20
---

<!-- overview -->
`kubectl`コマンドラインツールは、Kubernetesオブジェクトを作成、管理するためにいくつかの異なる方法をサポートしています。
このドキュメントでは、それらの異なるアプローチごとの概要を提供します。
Kubectlを使ったオブジェクト管理の詳細は、[Kubectl book](https://kubectl.docs.kubernetes.io)を参照してください。


<!-- body -->

## 管理手法

{{< warning >}}
Kubernetesのオブジェクトは、いずれか一つの手法で管理してください。
同じオブジェクトに対して、複数の手法を組み合わせた場合、未定義の挙動をもたらします。
{{< /warning >}}

| 管理手法                         | 何を対象にするか       | 推奨環境           | サポートライター     | 学習曲線       |
|----------------------------------|------------------------|--------------------|----------------------|----------------|
| 命令型コマンド                   | 現行のオブジェクト     | 開発用プロジェクト | 1+                   | 緩やか         |
| 命令型オブジェクト設定           | 個々のファイル         | 本番用プロジェクト | 1                    | 中程度         |
| 宣言型オブジェクト設定           | ファイルのディレクトリ | 本番用プロジェクト | 1+                   | 急             |

## 命令型コマンド

命令型コマンドを使う場合、ユーザーはクラスター内の現行のオブジェクトに対して処理を行います。
ユーザーは`kubectl`コマンドに処理内容を引数、もしくはフラグで指定します。

これはKubernetesの使い始め、またはクラスターに対して一度限りのタスクを行う際の最も簡単な手法です。
なぜなら、この手法は現行のオブジェクトに対して直接操作ができ、以前の設定履歴は提供されないからです。

### 例

Deploymentオブジェクトを作成し、nginxコンテナの単一インスタンスを起動します:

```sh
kubectl run nginx --image nginx
```

同じことを異なる構文で行います:

```sh
kubectl create deployment nginx --image nginx
```

### トレードオフ

オブジェクト設定手法に対する長所:

- コマンドは簡潔、簡単に学ぶことができ、そして覚えやすいです
- コマンドではクラスターの設定を変えるのに、わずか1ステップしか必要としません

オブジェクト設定手法に対する短所:

- コマンドは変更レビュープロセスと連携しません
- コマンドは変更に伴う監査証跡を提供しません
- コマンドは現行がどうなっているかという情報を除き、レコードのソースを提供しません
- コマンドはオブジェクトを作成するためのテンプレートを提供しません

## 命令型オブジェクト設定

命令型オブジェクト設定では、kubectlコマンドに処理内容(create、replaceなど)、任意のフラグ、そして最低1つのファイル名を指定します。
指定されたファイルは、YAMLまたはJSON形式でオブジェクトの全ての定義情報を含んでいなければいけません。

オブジェクト定義の詳細は、[APIリファレンス](/docs/reference/generated/kubernetes-api/{{< param "version" >}}/)を参照してください。

{{< warning >}}
命令型の`replace`コマンドは、既存の構成情報を新しく提供された設定に置き換え、設定ファイルに無いオブジェクトの全ての変更を削除します。
このアプローチは、構成情報が設定ファイルとは無関係に更新されるリソースタイプでは使用しないでください。
例えば、タイプが`LoadBalancer`のServiceオブジェクトにおける`externalIPs`フィールドは、設定ファイルとは無関係に、クラスターによって更新されます。
{{< /warning >}}

### 例

設定ファイルに定義されたオブジェクトを作成します:

```sh
kubectl create -f nginx.yaml
```

設定ファイルに定義されたオブジェクトを削除します:

```sh
kubectl delete -f nginx.yaml -f redis.yaml
```

設定ファイルに定義された情報で、現行の設定を上書き更新します:

```sh
kubectl replace -f nginx.yaml
```

### トレードオフ

命令型コマンド手法に対する長所:

- オブジェクト設定をGitのような、ソースコード管理システムに格納することができます
- オブジェクト設定の変更内容をプッシュする前にレビュー、監査証跡を残すようなプロセスと連携することができます
- オブジェクト設定は新しいオブジェクトを作る際のテンプレートを提供します

命令型コマンド手法に対する短所:

- オブジェクト設定ではオブジェクトスキーマの基礎的な理解が必要です
- オブジェクト設定ではYAMLファイルを書くという、追加のステップが必要です

宣言型オブジェクト設定手法に対する長所:

- 命令型オブジェクト設定の振る舞いは、よりシンプルで簡単に理解ができます
- Kubernetesバージョン1.5においては、命令型オブジェクト設定の方がより成熟しています

宣言型オブジェクト設定手法に対する短所:

- 命令型オブジェクト設定は各ファイルごとに設定を書くには最も適していますが、ディレクトリには適していません
- 現行オブジェクトの更新は設定ファイルに対して反映しなければなりません。反映されない場合、次の置き換え時に更新内容が失われてしまいます

## 宣言型オブジェクト設定

宣言型オブジェクト設定を利用する場合、ユーザーはローカルに置かれている設定ファイルを操作します。
しかし、ユーザーはファイルに対する操作内容を指定しません。作成、更新、そして削除といった操作はオブジェクトごとに`kubectl`が検出します。
この仕組みが、異なるオブジェクトごとに異なる操作をディレクトリに対して行うことを可能にしています。

{{< note >}}
宣言型オブジェクト設定は、他の人が行った変更が設定ファイルにマージされなかったとしても、それらの変更を保持します。
これは、`replace`API操作のように、全てのオブジェクト設定を置き換えるわけではなく、`patch`API操作による、変更箇所のみの更新が可能にしています。
{{< /note >}}

### 例

`config`ディレクトリ配下にある全てのオブジェクト設定ファイルを処理し、作成、または現行オブジェクトへのパッチを行います。
まず、`diff`でどのような変更が行われるかを確認した後に適用します:

```sh
kubectl diff -f configs/
kubectl apply -f configs/
```

再帰的にディレクトリを処理します:

```sh
kubectl diff -R -f configs/
kubectl apply -R -f configs/
```

### トレードオフ

命令型オブジェクト設定手法に対する長所:

- 現行オブジェクトに直接行われた変更が、それらが設定ファイルに反映されていなかったとしても、保持されます
- 宣言型オブジェクト設定は、ディレクトリごとの処理をより良くサポートしており、自動的にオブジェクトごとに操作のタイプ(作成、パッチ、削除)を検出します

命令型オブジェクト設定手法に対する短所:

- 宣言型オブジェクト設定は、デバッグ、そして想定外の結果が出たときに理解するのが困難です
- 差分を利用した一部のみの更新は、複雑なマージ、パッチの操作が必要です



## {{% heading "whatsnext" %}}


- [命令型コマンドを利用したKubernetesオブジェクトの管理](/docs/tasks/manage-kubernetes-objects/imperative-command/)
- [オブジェクト設定(命令型)を利用したKubernetesオブジェクトの管理](/docs/tasks/manage-kubernetes-objects/imperative-config/)
- [オブジェクト設定(宣言型)を利用したKubernetesオブジェクトの管理](/docs/tasks/manage-kubernetes-objects/declarative-config/)
- [Kustomize(宣言型)を利用したKubernetesオブジェクトの管理](/docs/tasks/manage-kubernetes-objects/kustomization/)
- [Kubectlコマンドリファレンス](/docs/reference/generated/kubectl/kubectl-commands/)
- [Kubectl Book](https://kubectl.docs.kubernetes.io)
- [Kubernetes APIリファレンス](/docs/reference/generated/kubernetes-api/{{< param "version" >}}/)


