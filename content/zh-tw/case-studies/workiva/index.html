---
title: 案例研究：Workiva

case_study_styles: true
cid: caseStudies
css: /css/style_workiva.css
---

<div class="banner1">
  <!-- <h1> CASE STUDY:<img src="/images/workiva_logo.png" style="margin-bottom:0%" class="header_logo"><br> <div class="subhead">Using OpenTracing to Help Pinpoint the Bottlenecks

</div></h1> -->
  <h1> 案例研究：<img src="/images/workiva_logo.png" style="margin-bottom:0%" class="header_logo"><br> <div class="subhead">使用 OpenTracing 幫助查找瓶頸

</div></h1>


</div>

<!-- <div class="details">
    Company &nbsp;<b>Workiva</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Location &nbsp;<b>Ames, Iowa</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Industry &nbsp;<b>Enterprise Software</b>
</div> -->
<div class="details">
    公司 &nbsp;<b>Workiva</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Location &nbsp;<b>艾姆斯，愛荷華州</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;行業 &nbsp;<b>企業軟件</b>
</div>


<hr>
<section class="section1">
<div class="cols">
  <div class="col1">
    <h2>挑戰</h2>
    <!-- <a href="https://www.workiva.com/">Workiva</a> offers a cloud-based platform for managing and reporting business data. This SaaS product, Wdesk, is used by more than 70 percent of the Fortune 500 companies. As the company made the shift from a monolith to a more distributed, microservice-based system, "We had a number of people working on this, all on different teams, so we needed to identify what the issues were and where the bottlenecks were," says Senior Software Architect MacLeod Broad. With back-end code running on Google App Engine, Google Compute Engine, as well as Amazon Web Services, Workiva needed a tracing system that was agnostic of platform. While preparing one of the company’s first products utilizing AWS, which involved a "sync and link" feature that linked data from spreadsheets built in the new application with documents created in the old application on Workiva’s existing system, Broad’s team found an ideal use case for tracing: There were circular dependencies, and optimizations often turned out to be micro-optimizations that didn’t impact overall speed. -->
<a href="https://www.workiva.com/">Workiva</a>提供了一個基於雲的平臺，用於管理和報告業務數據。此 SaaS 產品 Wdesk 被 70% 以上的財富 500 強企業使用。隨着公司從單體系統向更分散的基於微服務的系統轉變，“我們有許多人在研究這個問題，他們都在不同的團隊中，所以我們需要確定問題是什麼，瓶頸在哪裏，”高級軟件架構師 MacLeod Broad 說。隨着後端代碼在 Google App Engine，Google Compute Engine，以及 Amazon Web Services 上運行，Workiva 需要一個還未被開發的跟蹤系統。在準備公司首批使用 AWS 的產品時，Broad 的團隊將新應用程序中構建的電子表格數據與 Workiva 現有系統上的舊應用程序中創建的文檔相關聯，該功能涉及“同步和鏈接”功能，從而發現了一個理想的跟蹤用例：存在循環依賴關係，而優化通常證明是不影響整體速度的微優化。

<br>

</div>

<div class="col2">
 <h2>解決方案</h2>
    <!-- Broad’s team introduced the platform-agnostic distributed tracing system OpenTracing to help them pinpoint the bottlenecks.  -->
Broad 的團隊推出了與平臺無關的分佈式跟蹤系統 OpenTracing，幫助他們找出瓶頸。
<br>
<h2>影響</h2>
  <!-- Now used throughout the company, OpenTracing produced immediate results. Software Engineer Michael Davis reports: "Tracing has given us immediate, actionable insight into how to improve our service. Through a combination of seeing where each call spends its time, as well as which calls are most often used, we were able to reduce our average response time by 95 percent (from 600ms to 30ms) in a single fix." -->
現在在整個公司使用，OpenTracing 產生了立竿見影的效果。軟件工程師 Michael Davis 報告說：“跟蹤讓我們能夠立即瞭解如何改進我們的服務。通過查看每個調用的花費時間以及最常使用哪些調用的組合，我們能夠在單個修復中將平均響應時間減少 95%（從 600ms 到 30ms）。”

</div>

</div>
</section>
<div class="banner2">
  <div class="banner2text">
<!-- "With OpenTracing, my team was able to look at a trace and make optimization suggestions to another team without ever looking at their code." <span style="font-size:14px;letter-spacing:0.12em;padding-top:20px;text-transform:uppercase"><br>— MacLeod Broad, Senior Software Architect at Workiva</span> -->
使用 OpenTracing，我的團隊能夠查看跟蹤，並針對其他團隊提出優化建議，而無需查看他們的代碼。<span style="font-size:14px;letter-spacing:0.12em;padding-top:20px;text-transform:uppercase"><br>— MacLeod Broad, Workiva 高級軟件架構師</span>

  </div>
</div>
<section class="section2">
<div class="fullcol">
  <!-- <h2>Last fall, MacLeod Broad’s platform team at Workiva was prepping one of the company’s first products utilizing <a href="https://aws.amazon.com/">Amazon Web Services</a> when they ran into a roadblock.</h2> -->
<h2>去年秋天，MacLeod Broad 在 Workiva 的平臺團隊在準備該公司的首批產品之一，當遇到障礙時就使用 <a href="https://aws.amazon.com/">Amazon Web Services</a> 。</h2>
  <!-- Early on, Workiva’s backend had run mostly on <a href="https://cloud.google.com/appengine/">Google App Engine</a>. But things changed along the way as Workiva’s SaaS offering, <a href="https://www.workiva.com/wdesk">Wdesk</a>, a cloud-based platform for managing and reporting business data, grew its customer base to more than 70 percent of the Fortune 500 companies. "As customer needs grew and the product offering expanded, we started to leverage a wider offering of services such as Amazon Web Services as well as other Google Cloud Platform services, creating a multi-vendor environment."<br><br> -->
早期，Workiva 的後端主要運行在<a href="https://cloud.google.com/appengine/">Google App Engine</a>上。但隨着 Workiva 的 SaaS 產品，<a href="https://www.workiva.com/wdesk">Wdesk</a>，一種基於雲的管理和報告業務數據平臺，將客戶羣增長到財富 500 強公司的 70% 以上，情況發生了變化。“隨着客戶需求的增長和產品供應的擴大，我們開始利用更廣泛的服務，如 Amazon Web Services 以及其他 Google Cloud Platform 服務，從而創建一個多供應商環境。”

<!-- With this new product, there was a "sync and link" feature by which data "went through a whole host of services starting with the new spreadsheet system [<a href="https://aws.amazon.com/rds/aurora/">Amazon Aurora</a>] into what we called our linking system, and then pushed through http to our existing system, and then a number of calculations would go on, and the results would be transmitted back into the new system," says Broad. "We were trying to optimize that for speed. We thought we had made this great optimization and then it would turn out to be a micro optimization, which didn’t really affect the overall speed of things." <br><br> -->
有了這個新產品，具備“同步和鏈接”功能，通過它，數據“經歷了一大堆服務，從新的電子表格系統[<a href="https://aws.amazon.com/rds/aurora/">Amazon Aurora</a>]到我們所謂的鏈接系統，然後通過 http 推送到我們現有的系統，然後進行一些計算，結果將傳回新系統，”Broad 說。“我們當時進行優化是爲了速度。我們認爲做了這種極好的優化，然後它會變成一個微觀優化，這並沒有真正影響系統的整體速度。”<br><br>
<!-- The challenges faced by Broad’s team may sound familiar to other companies that have also made the shift from monoliths to more distributed, microservice-based systems. "We had a number of people working on this, all on different teams, so it was difficult to get our head around what the issues were and where the bottlenecks were," says Broad.<br><br> -->
Broad 團隊面臨的挑戰聽起來可能爲其他公司所熟悉，這些公司也從單體系統轉向更分散的基於微服務的系統。Broad 說：“我們有許多人從事這方面的工作，他們都在不同的團隊中，因此很難了解問題是什麼以及瓶頸在哪裏。”<br><br>
 <!-- "Each service team was going through different iterations of their architecture and it was very hard to follow what was actually going on in each teams’ system," he adds. "We had circular dependencies where we’d have three or four different service teams unsure of where the issues really were, requiring a lot of back and forth communication. So we wasted a lot of time saying, ‘What part of this is slow? Which part of this is sometimes slow depending on the use case? Which part is degrading over time? Which part of this process is asynchronous so it doesn’t really matter if it’s long-running or not? What are we doing that’s redundant, and which part of this is buggy?’" -->
“每個服務團隊都經歷着不同的架構迭代，很難了解每個團隊系統中的實際內容，”他補充道。“我們有循環依賴關係，其中有三個或四個不同的服務團隊不確定問題的真正位置，需要大量的來回溝通。因此，我們浪費了很多時間說，‘這個哪一部分比較慢？根據應用場景的不同，哪一部分有時很慢？隨着時間推移，哪一部分會逐漸變慢？這個進程的哪一部分是異步的，因此，它是否長時間運行並不重要？我們在做的哪些是多餘的，其中哪一部分是錯誤？’”


</div>
</section>
<div class="banner3">
  <div class="banner3text">
    <!-- "A tracing system can at a glance explain an architecture, narrow down a performance bottleneck and zero in on it, and generally just help direct an investigation at a high level. Being able to do that at a glance is much faster than at a meeting or with three days of debugging, and it’s a lot faster than never figuring out the problem and just moving on."<span style="font-size:14px;letter-spacing:0.12em;padding-top:20px;text-transform:uppercase"><br>— MACLEOD BROAD, SENIOR SOFTWARE ARCHITECT AT WORKIVA</span> -->
    “跟蹤系統可以一目瞭然地解釋體系結構，縮小性能瓶頸並歸零，通常只是幫助指導高級別的調查。一眼就能做到這一點，比在會議或三天的調試中要快得多，而且比從來不找出問題得過且過要快得多。”<span style="font-size:14px;letter-spacing:0.12em;padding-top:20px;text-transform:uppercase"><br>— MACLEOD BROAD, WORKIVA 高級軟件架構師</span>

  </div>
</div>
<section class="section3">
<div class="fullcol">

<!-- Simply put, it was an ideal use case for tracing. "A tracing system can at a glance explain an architecture, narrow down a performance bottleneck and zero in on it, and generally just help direct an investigation at a high level," says Broad. "Being able to do that at a glance is much faster than at a meeting or with three days of debugging, and it’s a lot faster than never figuring out the problem and just moving on."<br><br> -->
簡而言之，它是跟蹤的理想用例。Broad 說：“跟蹤系統可以一目瞭然地解釋體系結構，縮小性能瓶頸並歸零，通常只是幫助在高級別指導調查。”“一眼就能做到這一點，比在會議或三天的調試中要快得多，而且比從不找出問題得過且過要快得多。”<br><br>
<!-- With Workiva’s back-end code running on <a href="https://cloud.google.com/compute/">Google Compute Engine</a> as well as App Engine and AWS, Broad knew that he needed a tracing system that was platform agnostic. "We were looking at different tracing solutions," he says, "and we decided that because it seemed to be a very evolving market, we didn’t want to get stuck with one vendor. So OpenTracing seemed like the cleanest way to avoid vendor lock-in on what backend we actually had to use."<br><br> -->
Workiva 的後端代碼在 <a href="https://cloud.google.com/compute/">Google Compute Engine</a> 、App Engine 和 AWS 上運行，Broad 知道他需要一個與平臺無關的跟蹤系統。“我們正在研究不同的追蹤解決方案，”他說，“我們決定，由於市場似乎是一個不斷發展的市場，我們不想被一個供應商卡住。因此，OpenTracing 似乎是避免供應商限制我們實際使用的後端的最簡捷方法。”<br><br>
<!-- Once they introduced OpenTracing into this first use case, Broad says, "The trace made it super obvious where the bottlenecks were." Even though everyone had assumed it was Workiva’s existing code that was slowing things down, that wasn’t exactly the case. "It looked like the existing code was slow only because it was reaching out to our next-generation services, and they were taking a very long time to service all those requests," says Broad. "On the waterfall graph you can see the exact same work being done on every request when it was calling back in. So every service request would look the exact same for every response being paged out. And then it was just a no-brainer of, ‘Why is it doing all this work again?’"<br><br> -->
Broad 說，一旦他們將 OpenTrace 引入到第一個用例中，“跟蹤使得瓶頸所在位置變得非常明顯。”儘管每個人都認爲是 Workiva 的現有代碼減緩了速度，但事實並非如此。Broad 說：“看起來現有代碼速度很慢，只是因爲它能夠達到我們下一代服務的水平，而且它們需要很長時間才能處理所有這些請求。”“在瀑布圖上，你可以看到每個請求在得到響應時所做的完全相同的工作。因此，對於被分頁的每個響應，每個服務請求看起來都完全相同。然後，就不用費神去思考‘爲什麼它再次做所有這些工作？’”<br><br>
<!-- Using the insight OpenTracing gave them, "My team was able to look at a trace and make optimization suggestions to another team without ever looking at their code," says Broad. "The way we named our traces gave us insight whether it’s doing a SQL call or it’s making an RPC. And so it was really easy to say, ‘OK, we know that it’s going to page through all these requests. Do the work once and stuff it in cache.’ And we were done basically. All those calls became sub-second calls immediately."<br><br> -->
使用 OpenTrace 的跟蹤功能，“我的團隊能夠查看跟蹤，並針對另一個團隊提出優化建議，而無需查看他們的代碼，”Broad 說。“我們命名跟蹤的方式可以說明請求是執行 SQL 調用還是創建 RPC。因此，可以非常簡單地說，‘好吧，我們知道它能處理所有這些請求。處理一次緩存一次。’我們基本上完成了。所有這些調用立即變成了亞秒級的調用。”<br><br>

</div>
</section>

<div class="banner4">
  <div class="banner4text">
<!-- "We were looking at different tracing solutions and we decided that because it seemed to be a very evolving market, we didn’t want to get stuck with one vendor. So OpenTracing seemed like the cleanest way to avoid vendor lock-in on what backend we actually had to&nbsp;use." <span style="font-size:14px;letter-spacing:0.12em;padding-top:20px;text-transform:uppercase"><br>— MACLEOD BROAD, SENIOR SOFTWARE ARCHITECT AT WORKIVA</span> -->
“我們正在研究不同的跟蹤解決方案，我們決定使用 OpenTracing，由於市場似乎是一個不斷發展的市場，我們不想被一個供應商卡住。因此，OpenTracing 似乎是避免供應商限制我們實際使用的後端的最簡捷方法。”<span style="font-size:14px;letter-spacing:0.12em;padding-top:20px;text-transform:uppercase"><br>— MACLEOD BROAD, WORKIVA 高級軟件架構師</span>

  </div>
</div>

<section class="section4">
<div class="fullcol">
  <!-- After the success of the first use case, everyone involved in the trial went back and fully instrumented their products. Tracing was added to a few more use cases. "We wanted to get through the initial implementation pains early without bringing the whole department along for the ride," says Broad. "Now, a lot of teams add it when they’re starting up a new service. We’re really pushing adoption now more than we were before." <br><br> -->
在第一個用例成功後，參與嘗試的每個人都回去重新編排了他們的產品。跟蹤功能已添加到幾個更多的用例中。Broad 說：“我們希望儘早度過最初的實施難關，而不會讓整個部門一起渡過難關。”“現在，許多團隊在啓動新服務時添加它。我們現在確實比以前更將推動採用。”<br><br>
<!-- Some teams were won over quickly. "Tracing has given us immediate, actionable insight into how to improve our [Workspaces] service," says Software Engineer Michael Davis. "Through a combination of seeing where each call spends its time, as well as which calls are most often used, we were able to reduce our average response time by 95 percent (from 600ms to 30ms) in a single fix." <br><br> -->
一些團隊很快就贏了。軟件工程師 Michael Davis 說：“跟蹤讓我們能夠立即瞭解如何改進我們的（工作空間）服務。通過查看每個調用的花費時間以及最常使用哪些調用的組合，我們能夠在單個修復中將平均響應時間減少 95%（從 600ms 到 30ms）”。<br><br>
<!-- Most of Workiva’s major products are now traced using OpenTracing, with data pushed into <a href="https://cloud.google.com/stackdriver/">Google StackDriver</a>. Even the products that aren’t fully traced have some components and libraries that are. <br><br> -->
Workiva 的大部分主要產品現在都使用 OpenTracing 進行跟蹤，將數據推送到 <a href="https://cloud.google.com/stackdriver/">Google StackDriver</a>。即使未完全使用跟蹤功能的產品，也具有一些組件和庫。<br><br>
<!-- Broad points out that because some of the engineers were working on App Engine and already had experience with the platform’s Appstats library for profiling performance, it didn’t take much to get them used to using OpenTracing. But others were a little more reluctant. "The biggest hindrance to adoption I think has been the concern about how much latency is introducing tracing [and StackDriver] going to cost," he says. "People are also very concerned about adding middleware to whatever they’re working on. Questions about passing the context around and how that’s done were common. A lot of our Go developers were fine with it, because they were already doing that in one form or another. Our Java developers were not super keen on doing that because they’d used other systems that didn’t require that."<br><br> -->
Broad 指出，由於一些工程師正在使用 App Engine，並且已經擁有平臺的 Appstats 庫分析性能的經驗，因此他們不需要花太多時間才能習慣使用 OpenTracing。但其他人則有點不情願。“我認爲，使用 OpenTracing 的最大障礙是擔心引入跟蹤和 StackDriver 的成本會是多少，”他說。“人們也非常關心將中間件添加到他們正在處理的任何內容中。有關傳遞上下文以及如何完成這些工作的問題很常見。我們的許多 Go 開發人員對此都很好，因爲他們已經以這樣或那樣的形式這樣做了。我們的 Java 開發人員並不熱衷於這樣做，因爲他們使用了其他不需要該功能的系統。”<br><br>
<!-- But the benefits clearly outweighed the concerns, and today, Workiva’s official policy is to use tracing." -->
但好處顯然超過了人們的擔憂，而今天，Workiva 的官方政策是使用追蹤。
<!-- In fact, Broad believes that tracing naturally fits in with Workiva’s existing logging and metrics systems. "This was the way we presented it internally, and also the way we designed our use," he says. "Our traces are logged in the exact same mechanism as our app metric and logging data, and they get pushed the exact same way. So we treat all that data exactly the same when it’s being created and when it’s being recorded. We have one internal library that we use for logging, telemetry, analytics and tracing." -->
事實上，Broad 認爲跟蹤天然符合 Workiva 現有的日誌記錄和指標系統。“這是我們在內部展示的方式，也是我們設計使用方式的方式，”他說。“我們的跟蹤記錄在與我們的應用指標和日誌記錄數據完全相同的機制中，並且它們被推送的方式完全相同。因此，在創建和記錄所有數據時，我們對待這些數據完全一樣。我們有一個內部庫，用於日誌記錄、遙測、分析和跟蹤。”


</div>
</section>

<div class="banner5">
  <div class="banner5text">
   <!-- "Tracing has given us immediate, actionable insight into how to improve our [Workspaces] service. Through a combination of seeing where each call spends its time, as well as which calls are most often used, we were able to reduce our average response time by 95 percent (from 600ms to 30ms) in&nbsp;a&nbsp;single&nbsp;fix." <span style="font-size:14px;letter-spacing:0.12em;padding-top:20px;text-transform:uppercase"><br>— Michael Davis, Software Engineer, Workiva </span> -->
“跟蹤讓我們能夠立即、可操作地洞察如何改進我們的（工作空間）服務。通過查看每個調用花費的時間以及最常使用哪些調用的組合，我們能夠在單個修復中將平均響應時間減少 95%（從 600ms 到 30ms）。”<span style="font-size:14px;letter-spacing:0.12em;padding-top:20px;text-transform:uppercase"><br>— Michael Davis, 軟件工程師, Workiva </span>

  </div>
</div>

<section class="section5">
<div class="fullcol">
 <!-- For Workiva, OpenTracing has become an essential tool for zeroing in on optimizations and determining what’s actually a micro-optimization by observing usage patterns. "On some projects we often assume what the customer is doing, and we optimize for these crazy scale cases that we hit 1 percent of the time," says Broad. "It’s been really helpful to be able to say, ‘OK, we’re adding 100 milliseconds on every request that does X, and we only need to add that 100 milliseconds if it’s the worst of the worst case, which only happens one out of a thousand requests or one out of a million requests."<br><br> -->
對於 Workiva，OpenTracing 已成爲一種重要工具，通過觀察使用模式來聚焦最佳優化和確定什麼是微觀優化。Broad 說：“在某些項目中，我們經常假設客戶正在做什麼，我們針對這些瘋狂的測試案例進行優化，這些案例的 1% 是同使用者實際非常相符的。”“這樣是非常有益的，‘好吧，我們在每個執行 X 的請求上添加 100 毫秒，如果最壞的情況，我們也只需要添加 100 毫秒，這僅發生在千分之一的請求或一百萬個請求中的一個。’”<br><br>
<!-- Unlike many other companies, Workiva also traces the client side. "For us, the user experience is important—it doesn’t matter if the RPC takes 100 milliseconds if it still takes 5 seconds to do the rendering to show it in the browser," says Broad. "So for us, those client times are important. We trace it to see what parts of loading take a long time. We’re in the middle of working on a definition of what is ‘loaded.’ Is it when you have it, or when it’s rendered, or when you can interact with it? Those are things we’re planning to use tracing for to keep an eye on and to better understand."<br><br> -->
與許多其他公司不同，Workiva 還跟蹤客戶端。Broad 說：“對我們來說，使用者體驗很重要，如果 RPC 執行後還需要 5 秒才能在瀏覽器中顯示，則 RPC 執行需要 100 毫秒就不重要了。”“因此，對於我們而言，這些客戶端響應時間非常重要。我們跟蹤它，看看加載的哪些部分需要很長時間。我們正在研究什麼是“加載”的定義。是當你訪問到它，還是當它被渲染時，或者當你可以與它交互時？我們計劃使用跟蹤來關注和更好地瞭解這些內容。”<br><br>
<!-- That also requires adjusting for differences in external and internal clocks. "Before time correcting, it was horrible; our traces were more misleading than anything," says Broad. "So we decided that we would return a timestamp on the response headers, and then have the client reorient its time based on that—not change its internal clock but just calculate the offset on the response time to when the client got it. And if you end up in an impossible situation where a client RPC spans 210 milliseconds but the time on the response time is outside of that window, then we have to reorient that."<br><br> -->
這還需要根據外部和內部時鐘的差異進行調整。“在時間糾正之前，這是非常恐怖的；我們的跟蹤比什麼都更具有誤導性，” Broad 說。“因此，我們決定在響應標頭上返回一個時間戳，然後讓客戶端根據該時間調整其時間，而不是更改其內部時鐘，而只需計算客戶端收到時響應時間的偏移量。如果最終出現一種不可能的情況，客戶端的 RPC 調用持續了 210 毫秒但響應返回時間並不在這個範圍內，那就必須得重新調用請求。”<br><br>
<!-- Broad is excited about the impact OpenTracing has already had on the company, and is also looking ahead to what else the technology can enable. One possibility is using tracing to update documentation in real time. "Keeping documentation up to date with reality is a big challenge," he says. "Say, we just ran a trace simulation or we just ran a smoke test on this new deploy, and the architecture doesn’t match the documentation. We can find whose responsibility it is and let them know and have them update it. That’s one of the places I’d like to get in the future with tracing." -->
Broad 對 OpenTracing 對公司產生的影響感到興奮，並且也在展望該技術還能實現什麼。一種可能性是使用跟蹤實時更新文檔。他表示：“使文檔與現實保持同步是一項重大挑戰。”“例如，我們剛剛運行了跟蹤模擬，或者我們剛剛在此新部署上運行了煙霧測試，但是結果顯示架構與文檔不匹配。我們可以找到是誰的責任，並通知他們進行更新。這是我希望在未來通過追蹤獲得的功能之一。”

</div>

</section>
